<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Federal Grant Office | USG</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.png">
    <style>
        .grant-dashboard { max-width: 900px; margin: 40px auto; padding: 20px; }
        .grant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Grant List & Accordion */
        .grant-list { background: white; border: 1px solid var(--usg-border); border-radius: 8px; overflow: hidden; }
        .grant-entry { border-bottom: 1px solid #eee; transition: background 0.2s; }
        .grant-entry:last-child { border-bottom: none; }
        
        .grant-summary { 
            padding: 20px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; user-select: none;
        }
        .grant-summary:hover { background: #fcfcfc; }
        
        .grant-details { 
            padding: 0 20px; max-height: 0; overflow: hidden; 
            transition: max-height 0.3s ease-out, padding 0.3s ease;
            background: #f8f9fa; border-top: 0px solid #eee;
        }
        .grant-entry.active .grant-details { 
            max-height: 500px; padding: 20px; border-top: 1px solid #eee;
        }

        .info-label { font-size: 10px; text-transform: uppercase; color: #888; font-weight: bold; display: block; margin-bottom: 4px; }
        .info-value { font-family: monospace; font-size: 13px; color: #333; margin-bottom: 15px; display: block; }

        .status-pill { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        
        .hidden { display: none !important; }
        #grant-form-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; display: none; align-items: center; justify-content: center; }
        .form-container { background: white; width: 95%; max-width: 600px; padding: 40px; position: relative; border-radius: 4px; }
    </style>
</head>
<body style="display:block; background:#f9f9f9;">
    <div class="gov-banner">Official Federal Grant Application Portal</div>
    <header>
        <img src="favicon.png" class="seal" alt="USG Seal" onclick="location.href='index.html'" style="cursor:pointer;">
        <div class="header-title"><h1>Federal Grant Office</h1><span>Economic Stability Division</span></div>
    </header>

    <main class="grant-dashboard">
        <div class="grant-header">
            <h2>Your Grant Applications</h2>
            <button class="usa-button" onclick="openGrantForm()">Request Federal Grant</button>
        </div>

        <div class="grant-list" id="grant-history">
            </div>
    </main>

    <div id="grant-form-overlay">
        <div class="form-container">
            <div id="form-step-1">
                <h2 style="margin-top:0; border-bottom: 2px solid var(--usg-primary); padding-bottom: 10px;">Form G-100: Grant Request</h2>
                <div style="margin-top:20px;">
                    <label style="display:block; font-size:12px; font-weight:bold; margin-bottom:5px;">PURPOSE OF FUNDS</label>
                    <select id="grant-purpose" style="width:100%; padding:10px; margin-bottom:20px;">
                        <option>General Financial Silliness</option>
                        <option>Emergency Headpat Shortage</option>
                        <option>Anti-Hater Defense Expansion</option>
                        <option>Little Guy Business Growth</option>
                    </select>

                    <label style="display:block; font-size:12px; font-weight:bold; margin-bottom:5px;">STATEMENT OF NEED</label>
                    <textarea id="grant-statement" placeholder="Explain why the USG Treasury should give you money..." style="width:100%; height:100px; padding:10px; margin-bottom:20px; border: 1px solid #ccc;"></textarea>
                    
                    <button class="usa-button" style="width:100%;" onclick="proceedToPin()">Submit for Authorization</button>
                    <button class="usa-button" style="width:100%; background:#666; margin-top:10px;" onclick="closeGrantForm()">Cancel</button>
                </div>
            </div>

            <div id="form-step-pin" class="hidden">
                <div style="color:var(--usg-error); font-weight:bold; text-align:center; margin-bottom:20px;">AUTHORIZE WITH PIN2</div>
                <div class="pin-dots" id="dots" style="text-align:center; font-size:2rem; letter-spacing:10px; margin-bottom:20px;"></div>
                <div class="keypad" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; max-width: 300px; margin: 0 auto;">
                    <button class="key" onclick="press('1')">1</button><button class="key" onclick="press('2')">2</button><button class="key" onclick="press('3')">3</button>
                    <button class="key" onclick="press('4')">4</button><button class="key" onclick="press('5')">5</button><button class="key" onclick="press('6')">6</button>
                    <button class="key" onclick="press('7')">7</button><button class="key" onclick="press('8')">8</button><button class="key" onclick="press('9')">9</button>
                    <button class="key" onclick="press('C')" style="background:#ffcccb;">CLR</button><button class="key" onclick="press('0')">0</button>
                </div>
                <div style="position: absolute; bottom: 15px; right: 20px; text-align: right;">
                    <span style="font-size: 10px; color: #999;">Control Code</span><br>
                    <strong id="c-code" style="color: var(--usg-primary);">----</strong>
                </div>
            </div>

            <div id="form-step-final" class="hidden" style="text-align:center;">
                <div class="spinner" style="margin: 0 auto;"></div>
                <h3>Transmitting to Federal Treasury...</h3>
            </div>
        </div>
    </div>

    <script>
        let pin = "";
        let grants = JSON.parse(localStorage.getItem('usg_grant_apps') || "[]");

        window.onload = renderGrants;

        function renderGrants() {
            const container = document.getElementById('grant-history');
            if(grants.length === 0) {
                container.innerHTML = `<div style="padding:40px; text-align:center; color:#888;">No active grant applications found.</div>`;
                return;
            }
            container.innerHTML = grants.map((g, index) => `
                <div class="grant-entry" id="grant-${index}">
                    <div class="grant-summary" onclick="toggleGrant(${index})">
                        <div>
                            <strong>Request #${g.id}</strong><br>
                            <small style="color:#666;">USG$ ${g.amount.toLocaleString()}</small>
                        </div>
                        <div>
                            <span class="status-pill status-${g.status.toLowerCase()}">${g.status}</span>
                            ${g.status === 'APPROVED' ? `<button class="usa-button" onclick="event.stopPropagation(); collectMoney(${index})" style="padding: 5px 10px; margin-left:10px; font-size:10px;">Collect</button>` : ''}
                        </div>
                    </div>
                    <div class="grant-details">
                        <span class="info-label">Submission Timestamp</span>
                        <span class="info-value">${g.date}</span>
                        
                        <span class="info-label">Filing Purpose</span>
                        <span class="info-value">${g.purpose}</span>
                        
                        <span class="info-label">Statement of Need</span>
                        <p style="font-size: 13px; color: #555; background: #fff; padding: 10px; border-radius: 4px; border: 1px solid #eee; margin: 0;">
                            ${g.statement || "No statement provided."}
                        </p>
                    </div>
                </div>
            `).join('');
        }

        function toggleGrant(index) {
            const el = document.getElementById(`grant-${index}`);
            el.classList.toggle('active');
        }

        function openGrantForm() {
            document.getElementById('grant-form-overlay').style.display = 'flex';
            document.getElementById('c-code').innerText = Math.floor(1000 + Math.random()*9000);
        }

        function closeGrantForm() {
            document.getElementById('grant-form-overlay').style.display = 'none';
            resetForm();
        }

        function resetForm() {
            pin = "";
            document.getElementById('dots').innerText = "";
            document.getElementById('grant-statement').value = "";
            document.getElementById('form-step-1').classList.remove('hidden');
            document.getElementById('form-step-pin').classList.add('hidden');
            document.getElementById('form-step-final').classList.add('hidden');
        }

        function proceedToPin() {
            document.getElementById('form-step-1').classList.add('hidden');
            document.getElementById('form-step-pin').classList.remove('hidden');
        }

        function press(n) {
            if(n === 'C') pin = ""; else pin += n;
            document.getElementById('dots').innerText = "â€¢".repeat(pin.length);
            if(pin.length === 5) submitApplication();
        }

        function submitApplication() {
            document.getElementById('form-step-pin').classList.add('hidden');
            document.getElementById('form-step-final').classList.remove('hidden');

            setTimeout(() => {
                const newGrant = {
                    id: Math.floor(Math.random() * 900000 + 100000),
                    date: new Date().toLocaleString(),
                    purpose: document.getElementById('grant-purpose').value,
                    statement: document.getElementById('grant-statement').value,
                    amount: Math.floor(Math.random() * 15000 + 5000),
                    status: 'PENDING'
                };
                grants.unshift(newGrant);
                localStorage.setItem('usg_grant_apps', JSON.stringify(grants));
                simulateStatusUpdate(0);
                closeGrantForm();
                renderGrants();
            }, 2000);
        }

        function simulateStatusUpdate(index) {
            setTimeout(() => {
                const result = Math.random() > 0.3 ? 'APPROVED' : 'REJECTED';
                grants = JSON.parse(localStorage.getItem('usg_grant_apps')); // Refresh list
                grants[index].status = result;
                localStorage.setItem('usg_grant_apps', JSON.stringify(grants));
                renderGrants();
            }, 5000);
        }

        function collectMoney(index) {
            const amount = grants[index].amount;
            let balance = parseFloat(localStorage.getItem('usg_balance') || "0");
            balance += amount;
            localStorage.setItem('usg_balance', balance.toFixed(2));

            let history = JSON.parse(localStorage.getItem('usg_transactions') || "[]");
            history.unshift({ date: new Date().toLocaleString(), desc: "Federal Grant Collected", amount: amount });
            localStorage.setItem('usg_transactions', JSON.stringify(history));

            grants.splice(index, 1);
            localStorage.setItem('usg_grant_apps', JSON.stringify(grants));
            renderGrants();
        }
    </script>
</body>
</html>